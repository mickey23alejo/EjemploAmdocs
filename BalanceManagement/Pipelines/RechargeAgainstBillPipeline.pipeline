<?xml version="1.0" encoding="UTF-8"?>
<con:pipelineEntry xmlns:con="http://www.bea.com/wli/sb/pipeline/config">
    <con:coreEntry>
        <con:binding type="Any XML"/>
        <con:xqConfiguration>
            <con:snippetVersion>1.0</con:snippetVersion>
        </con:xqConfiguration>
    </con:coreEntry>
    <con:router>
        <con:pipeline type="error" name="error-a0a7841.N6b2c8fc6.2.1530ec6dacf.N7c41">
            <con:stage id="_StageId-a0a7841.N6b2c8fc6.2.1530ec6dacf.N7c40" name="DeleteCharge" errorHandler="error-a0a7841.N6b2c8fc6.2.1530ec6dacf.N7b35">
                <con:context/>
                <con:actions>
                    <con1:assign varName="deleteChargeRequest" xmlns:con1="http://www.bea.com/wli/sb/stages/transform/config">
                        <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-a0a7841.N6b2c8fc6.2.1530ec6dacf.N7c04</con2:id>
                        <con1:expr>
                            <con2:xqueryTransform xmlns:con2="http://www.bea.com/wli/sb/stages/config">
                                <con2:resource ref="BalanceManagement/XQueries/DeleteChargeRequest"/>
                                <con2:param name="chargeId">
                                    <con2:path>$createChargeResponse/*:return/chargeId/text()</con2:path>
                                </con2:param>
                            </con2:xqueryTransform>
                        </con1:expr>
                    </con1:assign>
                    <con1:assign varName="deleteChargeResponse" xmlns:con1="http://www.bea.com/wli/sb/stages/transform/config">
                        <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-a0a7841.491ba6da.0.15315437c12.N7bcb</con2:id>
                        <con1:expr>
                            <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">'false'</con2:xqueryText>
                        </con1:expr>
                    </con1:assign>
                    <con1:wsCallout xmlns:con1="http://www.bea.com/wli/sb/stages/transform/config">
                        <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-a0a7841.N6b2c8fc6.2.1530ec6dacf.N7bd0</con2:id>
                        <con1:service ref="AmdocsCkABP/BusinessServices/Invoicing/ChargeServiceBS" xsi:type="ref:BusinessServiceRef" xmlns:ref="http://www.bea.com/wli/sb/reference" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/>
                        <con1:operation>deleteCharge</con1:operation>
                        <con1:request>
                            <con1:body wrapped="false">deleteChargeRequest</con1:body>
                        </con1:request>
                        <con1:response>
                            <con1:body wrapped="false">deleteChargeResponse</con1:body>
                        </con1:response>
                        <con1:requestTransform>
                            <con1:assign varName="serviceRouteDeleteCharge">
                                <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-a0a7841.N43016fee.1.1531dfefce4.N7da7</con2:id>
                                <con1:expr>
                                    <con2:xqueryTransform xmlns:con2="http://www.bea.com/wli/sb/stages/config">
                                        <con2:resource ref="AmdocsCommon/XQueries/GetRoutingInfo"/>
                                        <con2:param name="routingId">
                                            <con2:path>'063'</con2:path>
                                        </con2:param>
                                        <con2:param name="type">
                                            <con2:path>'EJB'</con2:path>
                                        </con2:param>
                                    </con2:xqueryTransform>
                                </con1:expr>
                            </con1:assign>
                            <con1:routing-options>
                                <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-a0a7841.N43016fee.1.1531dfefce4.N7dda</con2:id>
                                <con1:uriExpr>
                                    <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">$serviceRouteDeleteCharge</con2:xqueryText>
                                </con1:uriExpr>
                            </con1:routing-options>
                            <con3:ifThenElse xmlns:con2="http://www.bea.com/wli/sb/stages/transform/config" xmlns:con1="http://www.bea.com/wli/sb/stages/routing/config" xmlns:con3="http://www.bea.com/wli/sb/stages/transform/config">
                                <con4:id xmlns:con4="http://www.bea.com/wli/sb/stages/config">_ActionId-a0a7841.491ba6da.0.15315437c12.N783c</con4:id>
                                <con2:case id="_BranchId-a0a7841.491ba6da.0.15315437c12.N783b">
                                    <con2:condition>
                                        <con3:xqueryText xmlns:con3="http://www.bea.com/wli/sb/stages/config">$traceLevel = "DEBUG"</con3:xqueryText>
                                    </con2:condition>
                                    <con2:actions>
                                        <con2:assign varName="deleteChargeID">
                                            <con4:id xmlns:con4="http://www.bea.com/wli/sb/stages/config">_ActionId-a0a7841.491ba6da.0.15315437c12.N783a</con4:id>
                                            <con2:expr>
                                                <con3:xqueryText xmlns:con3="http://www.bea.com/wli/sb/stages/config">fn-bea:uuid()</con3:xqueryText>
                                            </con2:expr>
                                        </con2:assign>
                                        <con2:assign varName="deleteChargeTraceMessageInput">
                                            <con4:id xmlns:con4="http://www.bea.com/wli/sb/stages/config">_ActionId-a0a7841.491ba6da.0.15315437c12.N7839</con4:id>
                                            <con2:expr>
                                                <con4:xqueryTransform xmlns:con4="http://www.bea.com/wli/sb/stages/config">
                                                    <con4:resource ref="AmdocsCommon/XQueries/CreateTraceMessage"/>
                                                    <con4:param name="parentId">
                                                        <con4:path>$esbMessageID</con4:path>
                                                    </con4:param>
                                                    <con4:param name="application">
                                                        <con4:path>""</con4:path>
                                                    </con4:param>
                                                    <con4:param name="transactionId">
                                                        <con4:path>$deleteChargeID</con4:path>
                                                    </con4:param>
                                                    <con4:param name="environment">
                                                        <con4:path>""</con4:path>
                                                    </con4:param>
                                                    <con4:param name="esbcontext">
                                                        <con4:path>$esbContext</con4:path>
                                                    </con4:param>
                                                    <con4:param name="layer">
                                                        <con4:path>"OrchestationLayer"</con4:path>
                                                    </con4:param>
                                                    <con4:param name="catalogId">
                                                        <con4:path>115</con4:path>
                                                    </con4:param>
                                                    <con4:param name="payload">
                                                        <con4:path>fn-bea:serialize($deleteChargeRequest)</con4:path>
                                                    </con4:param>
                                                    <con4:param name="referenceId">
                                                        <con4:path>""</con4:path>
                                                    </con4:param>
                                                </con4:xqueryTransform>
                                            </con2:expr>
                                        </con2:assign>
                                        <con3:route xmlns:con3="http://www.bea.com/wli/sb/stages/publish/config">
                                            <con4:id xmlns:con4="http://www.bea.com/wli/sb/stages/config">_ActionId-a0a7841.491ba6da.0.15315437c12.N7838</con4:id>
                                            <con3:service ref="AmdocsCommon/BusinessServices/EsbTraceBS" xsi:type="ref:BusinessServiceRef" xmlns:ref="http://www.bea.com/wli/sb/reference" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/>
                                            <con3:outboundTransform>
                                                <con2:replace contents-only="true" varName="body" xmlns:con4="http://www.bea.com/wli/sb/stages/transform/config">
                                                    <con5:id xmlns:con5="http://www.bea.com/wli/sb/stages/config">_ActionId-a0a7841.491ba6da.0.15315437c12.N7837</con5:id>
                                                    <con2:expr>
                                                        <con5:xqueryText xmlns:con5="http://www.bea.com/wli/sb/stages/config">$deleteChargeTraceMessageInput</con5:xqueryText>
                                                    </con2:expr>
                                                </con2:replace>
                                            </con3:outboundTransform>
                                        </con3:route>
                                    </con2:actions>
                                </con2:case>
                            </con3:ifThenElse>
                        </con1:requestTransform>
                        <con1:responseTransform>
                            <con3:ifThenElse xmlns:con2="http://www.bea.com/wli/sb/stages/transform/config" xmlns:con1="http://www.bea.com/wli/sb/stages/routing/config" xmlns:con3="http://www.bea.com/wli/sb/stages/transform/config">
                                <con4:id xmlns:con4="http://www.bea.com/wli/sb/stages/config">_ActionId-a0a7841.491ba6da.0.15315437c12.N76ce</con4:id>
                                <con2:case id="_BranchId-a0a7841.491ba6da.0.15315437c12.N76cd">
                                    <con2:condition>
                                        <con3:xqueryText xmlns:con3="http://www.bea.com/wli/sb/stages/config">$traceLevel = "DEBUG"</con3:xqueryText>
                                    </con2:condition>
                                    <con2:actions>
                                        <con2:assign varName="deleteChargeTraceMessageOutput">
                                            <con4:id xmlns:con4="http://www.bea.com/wli/sb/stages/config">_ActionId-a0a7841.491ba6da.0.15315437c12.N76cc</con4:id>
                                            <con2:expr>
                                                <con4:xqueryTransform xmlns:con4="http://www.bea.com/wli/sb/stages/config">
                                                    <con4:resource ref="AmdocsCommon/XQueries/CreateTraceMessage"/>
                                                    <con4:param name="parentId">
                                                        <con4:path>$esbMessageID</con4:path>
                                                    </con4:param>
                                                    <con4:param name="application">
                                                        <con4:path>""</con4:path>
                                                    </con4:param>
                                                    <con4:param name="transactionId">
                                                        <con4:path>$deleteChargeID</con4:path>
                                                    </con4:param>
                                                    <con4:param name="environment">
                                                        <con4:path>""</con4:path>
                                                    </con4:param>
                                                    <con4:param name="esbcontext">
                                                        <con4:path>$esbContext</con4:path>
                                                    </con4:param>
                                                    <con4:param name="layer">
                                                        <con4:path>"OrchestationLayer"</con4:path>
                                                    </con4:param>
                                                    <con4:param name="catalogId">
                                                        <con4:path>116</con4:path>
                                                    </con4:param>
                                                    <con4:param name="payload">
                                                        <con4:path>fn-bea:serialize($deleteChargeResponse)</con4:path>
                                                    </con4:param>
                                                    <con4:param name="referenceId">
                                                        <con4:path>""</con4:path>
                                                    </con4:param>
                                                </con4:xqueryTransform>
                                            </con2:expr>
                                        </con2:assign>
                                        <con3:route xmlns:con3="http://www.bea.com/wli/sb/stages/publish/config">
                                            <con4:id xmlns:con4="http://www.bea.com/wli/sb/stages/config">_ActionId-a0a7841.491ba6da.0.15315437c12.N76cb</con4:id>
                                            <con3:service ref="AmdocsCommon/BusinessServices/EsbTraceBS" xsi:type="ref:BusinessServiceRef" xmlns:ref="http://www.bea.com/wli/sb/reference" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/>
                                            <con3:outboundTransform>
                                                <con2:replace varName="body" contents-only="true" xmlns:con4="http://www.bea.com/wli/sb/stages/transform/config">
                                                    <con5:id xmlns:con5="http://www.bea.com/wli/sb/stages/config">_ActionId-a0a7841.491ba6da.0.15315437c12.N76ca</con5:id>
                                                    <con2:expr>
                                                        <con5:xqueryText xmlns:con5="http://www.bea.com/wli/sb/stages/config">$deleteChargeTraceMessageOutput</con5:xqueryText>
                                                    </con2:expr>
                                                </con2:replace>
                                            </con3:outboundTransform>
                                        </con3:route>
                                    </con2:actions>
                                </con2:case>
                            </con3:ifThenElse>
                        </con1:responseTransform>
                    </con1:wsCallout>
                    <con1:ifThenElse xmlns:con1="http://www.bea.com/wli/sb/stages/transform/config">
                        <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-a0a7841.491ba6da.0.15315437c12.N7bc4</con2:id>
                        <con1:case id="_BranchId-a0a7841.491ba6da.0.15315437c12.N7bc3">
                            <con1:condition>
                                <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">$bodyInicial/*[1]/*:RechargeAgainstBillRequestData/*:rechargeMethodInfo/*:rechargeAmount/*:units/text() = 'err'</con2:xqueryText>
                            </con1:condition>
                            <con1:actions>
                                <con2:assign varName="error" xmlns:con1="http://www.bea.com/wli/sb/stages/publish/config" xmlns:con2="http://www.bea.com/wli/sb/stages/transform/config">
                                    <con3:id xmlns:con3="http://www.bea.com/wli/sb/stages/config">_ActionId-a0a7841.491ba6da.0.15315437c12.N7bce</con3:id>
                                    <con2:expr>
                                        <con3:xqueryText xmlns:con3="http://www.bea.com/wli/sb/stages/config">&lt;error>Charge create but recharge failed&lt;/error></con3:xqueryText>
                                    </con2:expr>
                                </con2:assign>
                                <con1:route xmlns:con1="http://www.bea.com/wli/sb/stages/publish/config">
                                    <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-a0a7841.491ba6da.0.15315437c12.N7bcf</con2:id>
                                    <con1:service ref="BalanceManagement/BusinesServices/RechargeAgainstBillJmsBS" xsi:type="ref:BusinessServiceRef" xmlns:ref="http://www.bea.com/wli/sb/reference" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/>
                                    <con1:outboundTransform>
                                        <con2:replace varName="body" contents-only="true" xmlns:con2="http://www.bea.com/wli/sb/stages/transform/config">
                                            <con3:id xmlns:con3="http://www.bea.com/wli/sb/stages/config">_ActionId-a0a7841.491ba6da.0.15315437c12.N7b5f</con3:id>
                                            <con2:expr>
                                                <con3:xqueryText xmlns:con3="http://www.bea.com/wli/sb/stages/config">$error</con3:xqueryText>
                                            </con2:expr>
                                        </con2:replace>
                                        <con1:ifThenElse xmlns:con2="http://www.bea.com/wli/sb/stages/publish/config" xmlns:con1="http://www.bea.com/wli/sb/stages/transform/config">
                                            <con3:id xmlns:con3="http://www.bea.com/wli/sb/stages/config">_ActionId-a0a7841.N43016fee.1.1531dfefce4.N7cea</con3:id>
                                            <con1:case id="_BranchId-a0a7841.N43016fee.1.1531dfefce4.N7ce9">
                                                <con1:condition>
                                                    <con3:xqueryText xmlns:con3="http://www.bea.com/wli/sb/stages/config">$traceLevel = "DEBUG"</con3:xqueryText>
                                                </con1:condition>
                                                <con1:actions>
                                                    <con1:assign varName="RachargeAgainstBillID">
                                                        <con3:id xmlns:con3="http://www.bea.com/wli/sb/stages/config">_ActionId-a0a7841.N43016fee.1.1531dfefce4.N7ce8</con3:id>
                                                        <con1:expr>
                                                            <con3:xqueryText xmlns:con3="http://www.bea.com/wli/sb/stages/config">fn-bea:uuid()</con3:xqueryText>
                                                        </con1:expr>
                                                    </con1:assign>
                                                    <con1:assign varName="RachargeAgainstBillInput">
                                                        <con3:id xmlns:con3="http://www.bea.com/wli/sb/stages/config">_ActionId-a0a7841.N43016fee.1.1531dfefce4.N7ce7</con3:id>
                                                        <con1:expr>
                                                            <con3:xqueryTransform xmlns:con3="http://www.bea.com/wli/sb/stages/config">
                                                                <con3:resource ref="AmdocsCommon/XQueries/CreateTraceMessage"/>
                                                                <con3:param name="parentId">
                                                                    <con3:path>$esbMessageID</con3:path>
                                                                </con3:param>
                                                                <con3:param name="application">
                                                                    <con3:path>""</con3:path>
                                                                </con3:param>
                                                                <con3:param name="transactionId">
                                                                    <con3:path>$RachargeAgainstBillID</con3:path>
                                                                </con3:param>
                                                                <con3:param name="environment">
                                                                    <con3:path>""</con3:path>
                                                                </con3:param>
                                                                <con3:param name="esbcontext">
                                                                    <con3:path>$esbContext</con3:path>
                                                                </con3:param>
                                                                <con3:param name="layer">
                                                                    <con3:path>"OrchestrationLayer"</con3:path>
                                                                </con3:param>
                                                                <con3:param name="catalogId">
                                                                    <con3:path>119</con3:path>
                                                                </con3:param>
                                                                <con3:param name="payload">
                                                                    <con3:path>fn-bea:serialize($body/*[1])</con3:path>
                                                                </con3:param>
                                                                <con3:param name="referenceId">
                                                                    <con3:path>""</con3:path>
                                                                </con3:param>
                                                            </con3:xqueryTransform>
                                                        </con1:expr>
                                                    </con1:assign>
                                                    <con2:route xmlns:con3="http://www.bea.com/wli/sb/stages/publish/config">
                                                        <con4:id xmlns:con4="http://www.bea.com/wli/sb/stages/config">_ActionId-a0a7841.N43016fee.1.1531dfefce4.N7ce6</con4:id>
                                                        <con2:service ref="AmdocsCommon/BusinessServices/EsbTraceBS" xsi:type="ref:BusinessServiceRef" xmlns:ref="http://www.bea.com/wli/sb/reference" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/>
                                                        <con2:outboundTransform>
                                                            <con1:replace varName="body" contents-only="true">
                                                                <con4:id xmlns:con4="http://www.bea.com/wli/sb/stages/config">_ActionId-a0a7841.N43016fee.1.1531dfefce4.N7ce5</con4:id>
                                                                <con1:expr>
                                                                    <con4:xqueryText xmlns:con4="http://www.bea.com/wli/sb/stages/config">$RachargeAgainstBillInput</con4:xqueryText>
                                                                </con1:expr>
                                                            </con1:replace>
                                                        </con2:outboundTransform>
                                                    </con2:route>
                                                </con1:actions>
                                            </con1:case>
                                        </con1:ifThenElse>
                                    </con1:outboundTransform>
                                </con1:route>
                            </con1:actions>
                        </con1:case>
                    </con1:ifThenElse>
                    <con1:reply isError="true" xmlns:con1="http://www.bea.com/wli/sb/stages/config">
                        <con1:id>_ActionId-a0a7841.N6b2c8fc6.2.1530ec6dacf.N7b9c</con1:id>
                    </con1:reply>
                    <con1:Error xmlns:con1="http://www.bea.com/wli/sb/stages/transform/config">
                        <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-N3f57c7ff.N4a3f07c9.4.153d26aa5ff.N7f14</con2:id>
                        <con1:errCode>RC2</con1:errCode>
                        <con1:message>Recharge failed.</con1:message>
                    </con1:Error>
                </con:actions>
            </con:stage>
        </con:pipeline>
        <con:pipeline type="error" name="error-a0a7841.N6b2c8fc6.2.1530ec6dacf.N7b35">
            <con:stage id="_StageId-a0a7841.N6b2c8fc6.2.1530ec6dacf.N7b34" name="Stage1">
                <con:context/>
                <con:actions>
                    <con1:reply isError="true" xmlns:con1="http://www.bea.com/wli/sb/stages/config">
                        <con1:id>_ActionId-a0a7841.491ba6da.0.15315437c12.N7c35</con1:id>
                        <con1:disabled>true</con1:disabled>
                    </con1:reply>
                    <con1:Error xmlns:con1="http://www.bea.com/wli/sb/stages/transform/config">
                        <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-N3f57c7ff.N4a3f07c9.4.153d26aa5ff.N7f72</con2:id>
                        <con1:errCode>RC3</con1:errCode>
                        <con1:message>Charge create but recharge failed.</con1:message>
                    </con1:Error>
                </con:actions>
            </con:stage>
        </con:pipeline>
        <con:shared-variables>
            <con:variable>searchAccountByResourceRequest</con:variable>
            <con:variable>searchAccountByResourceResponse</con:variable>
            <con:variable>getAccountBillingArrangementListRequest</con:variable>
            <con:variable>getAccountBillingArrangementListResponse</con:variable>
            <con:variable>createChargeRequest</con:variable>
            <con:variable>createChargeResponse</con:variable>
            <con:variable>deleteChargeRequest</con:variable>
            <con:variable>deleteChargeResponse</con:variable>
            <con:variable>rechargeServiceRequest</con:variable>
            <con:variable>rechargeServiceResponse</con:variable>
            <con:variable>bodyInicial</con:variable>
        </con:shared-variables>
        <con:template-overrides>
            <con:placeholder-override id="PlaceholderID_a00020f.N4f4a7117.0.1508c0f7d74.N7fea"/>
            <con:action-override id="_ActionId-a00020f.Nc6ee96d.0.15095d4999c.N7e21">
                <con1:route xmlns:con1="http://www.bea.com/wli/sb/stages/publish/config">
                    <con1:service ref="AmdocsCommon/BusinessServices/EsbTraceBS" xsi:type="ref:BusinessServiceRef" xmlns:ref="http://www.bea.com/wli/sb/reference" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/>
                </con1:route>
            </con:action-override>
            <con:action-override id="_ActionId-a00020f.5c9e8f14.0.150870ea46a.N7dc9">
                <con1:validate xmlns:con1="http://www.bea.com/wli/sb/stages/transform/config">
                    <con1:schema ref="BalanceManagement/XSD/BalanceManagementServiceLocalCl_v001"/>
                    <con1:schemaElement xmlns:typ="http://telefonica.cl/ChargeCalculationAndBalanceManagement/BalanceManagement/V1/types">typ:RechargeAgainstBillRequest</con1:schemaElement>
                    <con1:location>
                        <con2:xpathText xmlns:con2="http://www.bea.com/wli/sb/stages/config">./*[1]</con2:xpathText>
                    </con1:location>
                </con1:validate>
            </con:action-override>
            <con:placeholder-override id="PlaceholderID_a00020f.5c9e8f14.0.150870ea46a.N7dc8">
                <con:actions/>
            </con:placeholder-override>
            <con:placeholder-override id="PlaceholderID_a00020f.5c9e8f14.0.150870ea46a.N7dbf"/>
            <con:action-override id="_ActionId-a00020f.N4f07eba7.0.15091fdcb72.N7f84">
                <con1:validate xmlns:con1="http://www.bea.com/wli/sb/stages/transform/config">
                    <con1:schema ref="BalanceManagement/XSD/BalanceManagementServiceLocalCl_v001"/>
                    <con1:schemaElement xmlns:typ="http://telefonica.cl/ChargeCalculationAndBalanceManagement/BalanceManagement/V1/types">typ:RechargeAgainstBillResponse</con1:schemaElement>
                    <con1:location>
                        <con2:xpathText xmlns:con2="http://www.bea.com/wli/sb/stages/config">./*[1]</con2:xpathText>
                    </con1:location>
                </con1:validate>
            </con:action-override>
            <con:action-override id="_ActionId-a00020f.Nc6ee96d.0.15095d4999c.N7e14">
                <con1:route xmlns:con1="http://www.bea.com/wli/sb/stages/publish/config">
                    <con1:service ref="AmdocsCommon/BusinessServices/EsbTraceBS" xsi:type="ref:BusinessServiceRef" xmlns:ref="http://www.bea.com/wli/sb/reference" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/>
                </con1:route>
            </con:action-override>
            <con:placeholder-override id="PlaceholderID_a00020f.5c9e8f14.0.150870ea46a.N7dc7">
                <con:stage id="_StageId-a0a7841.N5c8c7a.0.1530b2c2549.N7f7a" name="SearchByAccountResource">
                    <con:context/>
                    <con:actions>
                        <con1:assign varName="bodyInicial" xmlns:con1="http://www.bea.com/wli/sb/stages/transform/config">
                            <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-a0a7841.N6b2c8fc6.2.1530ec6dacf.N7dc5</con2:id>
                            <con1:expr>
                                <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">$body</con2:xqueryText>
                            </con1:expr>
                        </con1:assign>
                        <con1:assign varName="searchAccountByResourceRequest" xmlns:con1="http://www.bea.com/wli/sb/stages/transform/config">
                            <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-a0a7841.N6b2c8fc6.2.1530ec6dacf.N7f9e</con2:id>
                            <con1:expr>
                                <con2:xqueryTransform xmlns:con2="http://www.bea.com/wli/sb/stages/config">
                                    <con2:resource ref="BalanceManagement/XQueries/RechargeAgainstBillToSearchAccountByResourceRequest"/>
                                    <con2:param name="rechargeAgainstBillRequest">
                                        <con2:path>$body/*[1]</con2:path>
                                    </con2:param>
                                </con2:xqueryTransform>
                            </con1:expr>
                        </con1:assign>
                        <con1:wsCallout xmlns:con1="http://www.bea.com/wli/sb/stages/transform/config">
                            <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-a0a7841.N6b2c8fc6.2.1530ec6dacf.N7f9b</con2:id>
                            <con1:service ref="AmdocsCkABP/BusinessServices/CM/SearchServicesBS" xsi:type="ref:BusinessServiceRef" xmlns:ref="http://www.bea.com/wli/sb/reference" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/>
                            <con1:operation>searchAccountByResource</con1:operation>
                            <con1:request>
                                <con1:body wrapped="false">searchAccountByResourceRequest</con1:body>
                            </con1:request>
                            <con1:response>
                                <con1:body wrapped="false">searchAccountByResourceResponse</con1:body>
                            </con1:response>
                            <con1:requestTransform>
                                <con1:assign varName="serviceRouteSearchByAccountResource">
                                    <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-a0a7841.N43016fee.1.1531dfefce4.N7f73</con2:id>
                                    <con1:expr>
                                        <con2:xqueryTransform xmlns:con2="http://www.bea.com/wli/sb/stages/config">
                                            <con2:resource ref="AmdocsCommon/XQueries/GetRoutingInfo"/>
                                            <con2:param name="routingId">
                                                <con2:path>'060'</con2:path>
                                            </con2:param>
                                            <con2:param name="type">
                                                <con2:path>'EJB'</con2:path>
                                            </con2:param>
                                        </con2:xqueryTransform>
                                    </con1:expr>
                                </con1:assign>
                                <con1:routing-options>
                                    <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-a0a7841.N43016fee.1.1531dfefce4.N7f40</con2:id>
                                    <con1:uriExpr>
                                        <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">$serviceRouteSearchByAccountResource</con2:xqueryText>
                                    </con1:uriExpr>
                                </con1:routing-options>
                                <con3:ifThenElse xmlns:con2="http://www.bea.com/wli/sb/stages/transform/config" xmlns:con1="http://www.bea.com/wli/sb/stages/routing/config" xmlns:con3="http://www.bea.com/wli/sb/stages/transform/config">
                                    <con4:id xmlns:con4="http://www.bea.com/wli/sb/stages/config">_ActionId-a0a7841.491ba6da.0.15315437c12.N7ab5</con4:id>
                                    <con2:case id="_BranchId-a0a7841.491ba6da.0.15315437c12.N7ab4">
                                        <con2:condition>
                                            <con3:xqueryText xmlns:con3="http://www.bea.com/wli/sb/stages/config">$traceLevel = "DEBUG"</con3:xqueryText>
                                        </con2:condition>
                                        <con2:actions>
                                            <con2:assign varName="searchByAccountID">
                                                <con4:id xmlns:con4="http://www.bea.com/wli/sb/stages/config">_ActionId-a0a7841.491ba6da.0.15315437c12.N7ab3</con4:id>
                                                <con2:expr>
                                                    <con3:xqueryText xmlns:con3="http://www.bea.com/wli/sb/stages/config">fn-bea:uuid()</con3:xqueryText>
                                                </con2:expr>
                                            </con2:assign>
                                            <con2:assign varName="searchByAccountTraceMessageInput">
                                                <con4:id xmlns:con4="http://www.bea.com/wli/sb/stages/config">_ActionId-a0a7841.491ba6da.0.15315437c12.N7ab2</con4:id>
                                                <con2:expr>
                                                    <con4:xqueryTransform xmlns:con4="http://www.bea.com/wli/sb/stages/config">
                                                        <con4:resource ref="AmdocsCommon/XQueries/CreateTraceMessage"/>
                                                        <con4:param name="parentId">
                                                            <con4:path>$esbMessageID</con4:path>
                                                        </con4:param>
                                                        <con4:param name="application">
                                                            <con4:path>""</con4:path>
                                                        </con4:param>
                                                        <con4:param name="transactionId">
                                                            <con4:path>$searchByAccountID</con4:path>
                                                        </con4:param>
                                                        <con4:param name="environment">
                                                            <con4:path>""</con4:path>
                                                        </con4:param>
                                                        <con4:param name="esbcontext">
                                                            <con4:path>$esbContext</con4:path>
                                                        </con4:param>
                                                        <con4:param name="layer">
                                                            <con4:path>"OrchestationLayer"</con4:path>
                                                        </con4:param>
                                                        <con4:param name="catalogId">
                                                            <con4:path>107</con4:path>
                                                        </con4:param>
                                                        <con4:param name="payload">
                                                            <con4:path>fn-bea:serialize($searchAccountByResourceRequest)</con4:path>
                                                        </con4:param>
                                                        <con4:param name="referenceId">
                                                            <con4:path>""</con4:path>
                                                        </con4:param>
                                                    </con4:xqueryTransform>
                                                </con2:expr>
                                            </con2:assign>
                                            <con3:route xmlns:con3="http://www.bea.com/wli/sb/stages/publish/config">
                                                <con4:id xmlns:con4="http://www.bea.com/wli/sb/stages/config">_ActionId-a0a7841.491ba6da.0.15315437c12.N7ab1</con4:id>
                                                <con3:service ref="AmdocsCommon/BusinessServices/EsbTraceBS" xsi:type="ref:BusinessServiceRef" xmlns:ref="http://www.bea.com/wli/sb/reference" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/>
                                                <con3:outboundTransform>
                                                    <con2:replace contents-only="true" varName="body" xmlns:con4="http://www.bea.com/wli/sb/stages/transform/config">
                                                        <con5:id xmlns:con5="http://www.bea.com/wli/sb/stages/config">_ActionId-a0a7841.491ba6da.0.15315437c12.N7ab0</con5:id>
                                                        <con2:expr>
                                                            <con5:xqueryText xmlns:con5="http://www.bea.com/wli/sb/stages/config">$searchByAccountTraceMessageInput</con5:xqueryText>
                                                        </con2:expr>
                                                    </con2:replace>
                                                </con3:outboundTransform>
                                            </con3:route>
                                        </con2:actions>
                                    </con2:case>
                                </con3:ifThenElse>
                            </con1:requestTransform>
                            <con1:responseTransform>
                                <con3:ifThenElse xmlns:con2="http://www.bea.com/wli/sb/stages/transform/config" xmlns:con1="http://www.bea.com/wli/sb/stages/routing/config" xmlns:con3="http://www.bea.com/wli/sb/stages/transform/config">
                                    <con4:id xmlns:con4="http://www.bea.com/wli/sb/stages/config">_ActionId-a0a7841.491ba6da.0.15315437c12.N7a3d</con4:id>
                                    <con2:case id="_BranchId-a0a7841.491ba6da.0.15315437c12.N7a3c">
                                        <con2:condition>
                                            <con3:xqueryText xmlns:con3="http://www.bea.com/wli/sb/stages/config">$traceLevel = "DEBUG"</con3:xqueryText>
                                        </con2:condition>
                                        <con2:actions>
                                            <con2:assign varName="searchByAccountTraceMessageOutput">
                                                <con4:id xmlns:con4="http://www.bea.com/wli/sb/stages/config">_ActionId-a0a7841.491ba6da.0.15315437c12.N7a3b</con4:id>
                                                <con2:expr>
                                                    <con4:xqueryTransform xmlns:con4="http://www.bea.com/wli/sb/stages/config">
                                                        <con4:resource ref="AmdocsCommon/XQueries/CreateTraceMessage"/>
                                                        <con4:param name="parentId">
                                                            <con4:path>$esbMessageID</con4:path>
                                                        </con4:param>
                                                        <con4:param name="application">
                                                            <con4:path>""</con4:path>
                                                        </con4:param>
                                                        <con4:param name="transactionId">
                                                            <con4:path>$searchByAccountID</con4:path>
                                                        </con4:param>
                                                        <con4:param name="environment">
                                                            <con4:path>""</con4:path>
                                                        </con4:param>
                                                        <con4:param name="esbcontext">
                                                            <con4:path>$esbContext</con4:path>
                                                        </con4:param>
                                                        <con4:param name="layer">
                                                            <con4:path>"OrchestationLayer"</con4:path>
                                                        </con4:param>
                                                        <con4:param name="catalogId">
                                                            <con4:path>108</con4:path>
                                                        </con4:param>
                                                        <con4:param name="payload">
                                                            <con4:path>fn-bea:serialize($searchAccountByResourceResponse)</con4:path>
                                                        </con4:param>
                                                        <con4:param name="referenceId">
                                                            <con4:path>""</con4:path>
                                                        </con4:param>
                                                    </con4:xqueryTransform>
                                                </con2:expr>
                                            </con2:assign>
                                            <con3:route xmlns:con3="http://www.bea.com/wli/sb/stages/publish/config">
                                                <con4:id xmlns:con4="http://www.bea.com/wli/sb/stages/config">_ActionId-a0a7841.491ba6da.0.15315437c12.N7a3a</con4:id>
                                                <con3:service ref="AmdocsCommon/BusinessServices/EsbTraceBS" xsi:type="ref:BusinessServiceRef" xmlns:ref="http://www.bea.com/wli/sb/reference" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/>
                                                <con3:outboundTransform>
                                                    <con2:replace varName="body" contents-only="true" xmlns:con4="http://www.bea.com/wli/sb/stages/transform/config">
                                                        <con5:id xmlns:con5="http://www.bea.com/wli/sb/stages/config">_ActionId-a0a7841.491ba6da.0.15315437c12.N7a39</con5:id>
                                                        <con2:expr>
                                                            <con5:xqueryText xmlns:con5="http://www.bea.com/wli/sb/stages/config">$searchByAccountTraceMessageOutput</con5:xqueryText>
                                                        </con2:expr>
                                                    </con2:replace>
                                                </con3:outboundTransform>
                                            </con3:route>
                                        </con2:actions>
                                    </con2:case>
                                </con3:ifThenElse>
                            </con1:responseTransform>
                        </con1:wsCallout>
                    </con:actions>
                </con:stage>
                <con:stage id="_StageId-a0a7841.N6b2c8fc6.2.1530ec6dacf.N7e2e" name="CreateCharge">
                    <con:context/>
                    <con:actions>
                        <con1:assign varName="BAId" xmlns:con1="http://www.bea.com/wli/sb/stages/transform/config">
                            <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-a0a7841.N6b2c8fc6.2.1530ec6dacf.N7e31</con2:id>
                            <con1:expr>
                                <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">let $baNos := $searchAccountByResourceResponse/*:return/baPcnInfo[pcnCategory/text() = 'POST']/baNo
return
$baNos[1]/text()</con2:xqueryText>
                            </con1:expr>
                        </con1:assign>
                        <con1:assign varName="createChargeRequest" xmlns:con1="http://www.bea.com/wli/sb/stages/transform/config">
                            <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-a0a7841.N6b2c8fc6.2.1530ec6dacf.N7d57</con2:id>
                            <con1:expr>
                                <con2:xqueryTransform xmlns:con2="http://www.bea.com/wli/sb/stages/config">
                                    <con2:resource ref="BalanceManagement/XQueries/RechargeAgainstBillRequestToCreateChargeInput"/>
                                    <con2:param name="rechargeAgainstBillRequest">
                                        <con2:path>$body/*[1]</con2:path>
                                    </con2:param>
                                    <con2:param name="BAid">
                                        <con2:path>xs:long(xs:string($BAId))</con2:path>
                                    </con2:param>
                                </con2:xqueryTransform>
                            </con1:expr>
                        </con1:assign>
                        <con1:wsCallout xmlns:con1="http://www.bea.com/wli/sb/stages/transform/config">
                            <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-a0a7841.N6b2c8fc6.2.1530ec6dacf.N7d89</con2:id>
                            <con1:service ref="AmdocsCkABP/BusinessServices/Invoicing/ChargeServiceBS" xsi:type="ref:BusinessServiceRef" xmlns:ref="http://www.bea.com/wli/sb/reference" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/>
                            <con1:operation>createCharge</con1:operation>
                            <con1:request>
                                <con1:body wrapped="false">createChargeRequest</con1:body>
                            </con1:request>
                            <con1:response>
                                <con1:body wrapped="false">createChargeResponse</con1:body>
                            </con1:response>
                            <con1:requestTransform>
                                <con1:assign varName="serviceRouteCreateCharge">
                                    <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-a0a7841.N43016fee.1.1531dfefce4.N7e73</con2:id>
                                    <con1:expr>
                                        <con2:xqueryTransform xmlns:con2="http://www.bea.com/wli/sb/stages/config">
                                            <con2:resource ref="AmdocsCommon/XQueries/GetRoutingInfo"/>
                                            <con2:param name="routingId">
                                                <con2:path>'059'</con2:path>
                                            </con2:param>
                                            <con2:param name="type">
                                                <con2:path>'EJB'</con2:path>
                                            </con2:param>
                                        </con2:xqueryTransform>
                                    </con1:expr>
                                </con1:assign>
                                <con1:routing-options>
                                    <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-a0a7841.N43016fee.1.1531dfefce4.N7ea6</con2:id>
                                    <con1:uriExpr>
                                        <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">$serviceRouteCreateCharge</con2:xqueryText>
                                    </con1:uriExpr>
                                </con1:routing-options>
                                <con3:ifThenElse xmlns:con2="http://www.bea.com/wli/sb/stages/transform/config" xmlns:con1="http://www.bea.com/wli/sb/stages/routing/config" xmlns:con3="http://www.bea.com/wli/sb/stages/transform/config">
                                    <con4:id xmlns:con4="http://www.bea.com/wli/sb/stages/config">_ActionId-a0a7841.491ba6da.0.15315437c12.N78c8</con4:id>
                                    <con2:case id="_BranchId-a0a7841.491ba6da.0.15315437c12.N78c7">
                                        <con2:condition>
                                            <con3:xqueryText xmlns:con3="http://www.bea.com/wli/sb/stages/config">$traceLevel = "DEBUG"</con3:xqueryText>
                                        </con2:condition>
                                        <con2:actions>
                                            <con2:assign varName="createChargeID">
                                                <con4:id xmlns:con4="http://www.bea.com/wli/sb/stages/config">_ActionId-a0a7841.491ba6da.0.15315437c12.N78c6</con4:id>
                                                <con2:expr>
                                                    <con3:xqueryText xmlns:con3="http://www.bea.com/wli/sb/stages/config">fn-bea:uuid()</con3:xqueryText>
                                                </con2:expr>
                                            </con2:assign>
                                            <con2:assign varName="createChargeTraceMessageInput">
                                                <con4:id xmlns:con4="http://www.bea.com/wli/sb/stages/config">_ActionId-a0a7841.491ba6da.0.15315437c12.N78c5</con4:id>
                                                <con2:expr>
                                                    <con4:xqueryTransform xmlns:con4="http://www.bea.com/wli/sb/stages/config">
                                                        <con4:resource ref="AmdocsCommon/XQueries/CreateTraceMessage"/>
                                                        <con4:param name="parentId">
                                                            <con4:path>$esbMessageID</con4:path>
                                                        </con4:param>
                                                        <con4:param name="application">
                                                            <con4:path>""</con4:path>
                                                        </con4:param>
                                                        <con4:param name="transactionId">
                                                            <con4:path>$createChargeID</con4:path>
                                                        </con4:param>
                                                        <con4:param name="environment">
                                                            <con4:path>""</con4:path>
                                                        </con4:param>
                                                        <con4:param name="esbcontext">
                                                            <con4:path>$esbContext</con4:path>
                                                        </con4:param>
                                                        <con4:param name="layer">
                                                            <con4:path>"OrchestationLayer"</con4:path>
                                                        </con4:param>
                                                        <con4:param name="catalogId">
                                                            <con4:path>111</con4:path>
                                                        </con4:param>
                                                        <con4:param name="payload">
                                                            <con4:path>fn-bea:serialize($createChargeRequest)</con4:path>
                                                        </con4:param>
                                                        <con4:param name="referenceId">
                                                            <con4:path>""</con4:path>
                                                        </con4:param>
                                                    </con4:xqueryTransform>
                                                </con2:expr>
                                            </con2:assign>
                                            <con3:route xmlns:con3="http://www.bea.com/wli/sb/stages/publish/config">
                                                <con4:id xmlns:con4="http://www.bea.com/wli/sb/stages/config">_ActionId-a0a7841.491ba6da.0.15315437c12.N78c4</con4:id>
                                                <con3:service ref="AmdocsCommon/BusinessServices/EsbTraceBS" xsi:type="ref:BusinessServiceRef" xmlns:ref="http://www.bea.com/wli/sb/reference" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/>
                                                <con3:outboundTransform>
                                                    <con2:replace contents-only="true" varName="body" xmlns:con4="http://www.bea.com/wli/sb/stages/transform/config">
                                                        <con5:id xmlns:con5="http://www.bea.com/wli/sb/stages/config">_ActionId-a0a7841.491ba6da.0.15315437c12.N78c3</con5:id>
                                                        <con2:expr>
                                                            <con5:xqueryText xmlns:con5="http://www.bea.com/wli/sb/stages/config">$createChargeTraceMessageInput</con5:xqueryText>
                                                        </con2:expr>
                                                    </con2:replace>
                                                </con3:outboundTransform>
                                            </con3:route>
                                        </con2:actions>
                                    </con2:case>
                                </con3:ifThenElse>
                            </con1:requestTransform>
                            <con1:responseTransform>
                                <con3:ifThenElse xmlns:con2="http://www.bea.com/wli/sb/stages/transform/config" xmlns:con1="http://www.bea.com/wli/sb/stages/routing/config" xmlns:con3="http://www.bea.com/wli/sb/stages/transform/config">
                                    <con4:id xmlns:con4="http://www.bea.com/wli/sb/stages/config">_ActionId-a0a7841.491ba6da.0.15315437c12.N77c4</con4:id>
                                    <con2:case id="_BranchId-a0a7841.491ba6da.0.15315437c12.N77c3">
                                        <con2:condition>
                                            <con3:xqueryText xmlns:con3="http://www.bea.com/wli/sb/stages/config">$traceLevel = "DEBUG"</con3:xqueryText>
                                        </con2:condition>
                                        <con2:actions>
                                            <con2:assign varName="createChargeTraceMessageOutput">
                                                <con4:id xmlns:con4="http://www.bea.com/wli/sb/stages/config">_ActionId-a0a7841.491ba6da.0.15315437c12.N77c2</con4:id>
                                                <con2:expr>
                                                    <con4:xqueryTransform xmlns:con4="http://www.bea.com/wli/sb/stages/config">
                                                        <con4:resource ref="AmdocsCommon/XQueries/CreateTraceMessage"/>
                                                        <con4:param name="parentId">
                                                            <con4:path>$esbMessageID</con4:path>
                                                        </con4:param>
                                                        <con4:param name="application">
                                                            <con4:path>""</con4:path>
                                                        </con4:param>
                                                        <con4:param name="transactionId">
                                                            <con4:path>$createChargeID</con4:path>
                                                        </con4:param>
                                                        <con4:param name="environment">
                                                            <con4:path>""</con4:path>
                                                        </con4:param>
                                                        <con4:param name="esbcontext">
                                                            <con4:path>$esbContext</con4:path>
                                                        </con4:param>
                                                        <con4:param name="layer">
                                                            <con4:path>"OrchestationLayer"</con4:path>
                                                        </con4:param>
                                                        <con4:param name="catalogId">
                                                            <con4:path>112</con4:path>
                                                        </con4:param>
                                                        <con4:param name="payload">
                                                            <con4:path>fn-bea:serialize($createChargeResponse)</con4:path>
                                                        </con4:param>
                                                        <con4:param name="referenceId">
                                                            <con4:path>""</con4:path>
                                                        </con4:param>
                                                    </con4:xqueryTransform>
                                                </con2:expr>
                                            </con2:assign>
                                            <con3:route xmlns:con3="http://www.bea.com/wli/sb/stages/publish/config">
                                                <con4:id xmlns:con4="http://www.bea.com/wli/sb/stages/config">_ActionId-a0a7841.491ba6da.0.15315437c12.N77c1</con4:id>
                                                <con3:service ref="AmdocsCommon/BusinessServices/EsbTraceBS" xsi:type="ref:BusinessServiceRef" xmlns:ref="http://www.bea.com/wli/sb/reference" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/>
                                                <con3:outboundTransform>
                                                    <con2:replace varName="body" contents-only="true" xmlns:con4="http://www.bea.com/wli/sb/stages/transform/config">
                                                        <con5:id xmlns:con5="http://www.bea.com/wli/sb/stages/config">_ActionId-a0a7841.491ba6da.0.15315437c12.N77c0</con5:id>
                                                        <con2:expr>
                                                            <con5:xqueryText xmlns:con5="http://www.bea.com/wli/sb/stages/config">$createChargeTraceMessageOutput</con5:xqueryText>
                                                        </con2:expr>
                                                    </con2:replace>
                                                </con3:outboundTransform>
                                            </con3:route>
                                        </con2:actions>
                                    </con2:case>
                                </con3:ifThenElse>
                            </con1:responseTransform>
                        </con1:wsCallout>
                    </con:actions>
                </con:stage>
                <con:stage id="_StageId-a0a7841.N6b2c8fc6.2.1530ec6dacf.N7cc0" name="RechargeService" errorHandler="error-a0a7841.N6b2c8fc6.2.1530ec6dacf.N7c41">
                    <con:context/>
                    <con:actions>
                        <con1:assign varName="rechargeServiceRequest" xmlns:con1="http://www.bea.com/wli/sb/stages/transform/config">
                            <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-a0a7841.N6b2c8fc6.2.1530ec6dacf.N7cbc</con2:id>
                            <con1:expr>
                                <con2:xqueryTransform xmlns:con2="http://www.bea.com/wli/sb/stages/config">
                                    <con2:resource ref="BalanceManagement/XQueries/RechargeAgainstBillRequestToRechargeService"/>
                                    <con2:param name="rechargeAgainstBillRequest">
                                        <con2:path>$bodyInicial/*[1]</con2:path>
                                    </con2:param>
                                </con2:xqueryTransform>
                            </con1:expr>
                        </con1:assign>
                        <con1:wsCallout xmlns:con1="http://www.bea.com/wli/sb/stages/transform/config">
                            <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-a0a7841.N6b2c8fc6.2.1530ec6dacf.N7cb8</con2:id>
                            <con1:service ref="BalanceManagement/Pipelines/RechargeServicePipeline" xsi:type="con:PipelineRef" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/>
                            <con1:operation>rechargeService</con1:operation>
                            <con1:request>
                                <con1:body wrapped="false">rechargeServiceRequest</con1:body>
                            </con1:request>
                            <con1:response>
                                <con1:body wrapped="false">rechargeServiceResponse</con1:body>
                            </con1:response>
                            <con1:requestTransform>
                                <con3:ifThenElse xmlns:con2="http://www.bea.com/wli/sb/stages/transform/config" xmlns:con1="http://www.bea.com/wli/sb/stages/routing/config" xmlns:con3="http://www.bea.com/wli/sb/stages/transform/config">
                                    <con4:id xmlns:con4="http://www.bea.com/wli/sb/stages/config">_ActionId-a0a7841.491ba6da.0.15315437c12.N7882</con4:id>
                                    <con2:case id="_BranchId-a0a7841.491ba6da.0.15315437c12.N7881">
                                        <con2:condition>
                                            <con3:xqueryText xmlns:con3="http://www.bea.com/wli/sb/stages/config">$traceLevel = "DEBUG"</con3:xqueryText>
                                        </con2:condition>
                                        <con2:actions>
                                            <con2:assign varName="rechargeServiceID">
                                                <con4:id xmlns:con4="http://www.bea.com/wli/sb/stages/config">_ActionId-a0a7841.491ba6da.0.15315437c12.N7880</con4:id>
                                                <con2:expr>
                                                    <con3:xqueryText xmlns:con3="http://www.bea.com/wli/sb/stages/config">fn-bea:uuid()</con3:xqueryText>
                                                </con2:expr>
                                            </con2:assign>
                                            <con2:assign varName="rechargeServiceTraceMessageInput">
                                                <con4:id xmlns:con4="http://www.bea.com/wli/sb/stages/config">_ActionId-a0a7841.491ba6da.0.15315437c12.N787f</con4:id>
                                                <con2:expr>
                                                    <con4:xqueryTransform xmlns:con4="http://www.bea.com/wli/sb/stages/config">
                                                        <con4:resource ref="AmdocsCommon/XQueries/CreateTraceMessage"/>
                                                        <con4:param name="parentId">
                                                            <con4:path>$esbMessageID</con4:path>
                                                        </con4:param>
                                                        <con4:param name="application">
                                                            <con4:path>""</con4:path>
                                                        </con4:param>
                                                        <con4:param name="transactionId">
                                                            <con4:path>$rechargeServiceID</con4:path>
                                                        </con4:param>
                                                        <con4:param name="environment">
                                                            <con4:path>""</con4:path>
                                                        </con4:param>
                                                        <con4:param name="esbcontext">
                                                            <con4:path>$esbContext</con4:path>
                                                        </con4:param>
                                                        <con4:param name="layer">
                                                            <con4:path>"OrchestationLayer"</con4:path>
                                                        </con4:param>
                                                        <con4:param name="catalogId">
                                                            <con4:path>113</con4:path>
                                                        </con4:param>
                                                        <con4:param name="payload">
                                                            <con4:path>fn-bea:serialize($rechargeServiceRequest)</con4:path>
                                                        </con4:param>
                                                        <con4:param name="referenceId">
                                                            <con4:path>""</con4:path>
                                                        </con4:param>
                                                    </con4:xqueryTransform>
                                                </con2:expr>
                                            </con2:assign>
                                            <con3:route xmlns:con3="http://www.bea.com/wli/sb/stages/publish/config">
                                                <con4:id xmlns:con4="http://www.bea.com/wli/sb/stages/config">_ActionId-a0a7841.491ba6da.0.15315437c12.N787e</con4:id>
                                                <con3:service ref="AmdocsCommon/BusinessServices/EsbTraceBS" xsi:type="ref:BusinessServiceRef" xmlns:ref="http://www.bea.com/wli/sb/reference" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/>
                                                <con3:outboundTransform>
                                                    <con2:replace contents-only="true" varName="body" xmlns:con4="http://www.bea.com/wli/sb/stages/transform/config">
                                                        <con5:id xmlns:con5="http://www.bea.com/wli/sb/stages/config">_ActionId-a0a7841.491ba6da.0.15315437c12.N787d</con5:id>
                                                        <con2:expr>
                                                            <con5:xqueryText xmlns:con5="http://www.bea.com/wli/sb/stages/config">$rechargeServiceTraceMessageInput</con5:xqueryText>
                                                        </con2:expr>
                                                    </con2:replace>
                                                </con3:outboundTransform>
                                            </con3:route>
                                        </con2:actions>
                                    </con2:case>
                                </con3:ifThenElse>
                            </con1:requestTransform>
                            <con1:responseTransform>
                                <con3:ifThenElse xmlns:con2="http://www.bea.com/wli/sb/stages/transform/config" xmlns:con1="http://www.bea.com/wli/sb/stages/routing/config" xmlns:con3="http://www.bea.com/wli/sb/stages/transform/config">
                                    <con4:id xmlns:con4="http://www.bea.com/wli/sb/stages/config">_ActionId-a0a7841.491ba6da.0.15315437c12.N7748</con4:id>
                                    <con2:case id="_BranchId-a0a7841.491ba6da.0.15315437c12.N7747">
                                        <con2:condition>
                                            <con3:xqueryText xmlns:con3="http://www.bea.com/wli/sb/stages/config">$traceLevel = "DEBUG"</con3:xqueryText>
                                        </con2:condition>
                                        <con2:actions>
                                            <con2:assign varName="rechargeServiceTraceMessageOutput">
                                                <con4:id xmlns:con4="http://www.bea.com/wli/sb/stages/config">_ActionId-a0a7841.491ba6da.0.15315437c12.N7746</con4:id>
                                                <con2:expr>
                                                    <con4:xqueryTransform xmlns:con4="http://www.bea.com/wli/sb/stages/config">
                                                        <con4:resource ref="AmdocsCommon/XQueries/CreateTraceMessage"/>
                                                        <con4:param name="parentId">
                                                            <con4:path>$esbMessageID</con4:path>
                                                        </con4:param>
                                                        <con4:param name="application">
                                                            <con4:path>""</con4:path>
                                                        </con4:param>
                                                        <con4:param name="transactionId">
                                                            <con4:path>$rechargeServiceID</con4:path>
                                                        </con4:param>
                                                        <con4:param name="environment">
                                                            <con4:path>""</con4:path>
                                                        </con4:param>
                                                        <con4:param name="esbcontext">
                                                            <con4:path>$esbContext</con4:path>
                                                        </con4:param>
                                                        <con4:param name="layer">
                                                            <con4:path>"OrchestationLayer"</con4:path>
                                                        </con4:param>
                                                        <con4:param name="catalogId">
                                                            <con4:path>114</con4:path>
                                                        </con4:param>
                                                        <con4:param name="payload">
                                                            <con4:path>fn-bea:serialize($rechargeServiceResponse)</con4:path>
                                                        </con4:param>
                                                        <con4:param name="referenceId">
                                                            <con4:path>""</con4:path>
                                                        </con4:param>
                                                    </con4:xqueryTransform>
                                                </con2:expr>
                                            </con2:assign>
                                            <con3:route xmlns:con3="http://www.bea.com/wli/sb/stages/publish/config">
                                                <con4:id xmlns:con4="http://www.bea.com/wli/sb/stages/config">_ActionId-a0a7841.491ba6da.0.15315437c12.N7745</con4:id>
                                                <con3:service ref="AmdocsCommon/BusinessServices/EsbTraceBS" xsi:type="ref:BusinessServiceRef" xmlns:ref="http://www.bea.com/wli/sb/reference" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/>
                                                <con3:outboundTransform>
                                                    <con2:replace varName="body" contents-only="true" xmlns:con4="http://www.bea.com/wli/sb/stages/transform/config">
                                                        <con5:id xmlns:con5="http://www.bea.com/wli/sb/stages/config">_ActionId-a0a7841.491ba6da.0.15315437c12.N7744</con5:id>
                                                        <con2:expr>
                                                            <con5:xqueryText xmlns:con5="http://www.bea.com/wli/sb/stages/config">$rechargeServiceTraceMessageOutput</con5:xqueryText>
                                                        </con2:expr>
                                                    </con2:replace>
                                                </con3:outboundTransform>
                                            </con3:route>
                                        </con2:actions>
                                    </con2:case>
                                </con3:ifThenElse>
                            </con1:responseTransform>
                        </con1:wsCallout>
                    </con:actions>
                </con:stage>
            </con:placeholder-override>
            <con:placeholder-override id="PlaceholderID_a00020f.N4f07eba7.0.15091fdcb72.N7fc2">
                <con:stage id="_StageId-a0a7841.N5c8c7a.0.1530b2c2549.N7f49" name="ProducerToOutput">
                    <con:context>
                        <con1:userNsDecl prefix="esb" namespace="http://telefonica.com/chile/esb/context" xmlns:con1="http://www.bea.com/wli/sb/stages/config"/>
                    </con:context>
                    <con:actions>
                        <con1:replace varName="body" contents-only="true" xmlns:con1="http://www.bea.com/wli/sb/stages/transform/config">
                            <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-a0a7841.N6b2c8fc6.2.1530ec6dacf.N7c73</con2:id>
                            <con1:expr>
                                <con2:xqueryTransform xmlns:con2="http://www.bea.com/wli/sb/stages/config">
                                    <con2:resource ref="BalanceManagement/XQueries/RechargeServiceResponseToRechargeAgainstBill"/>
                                    <con2:param name="tefHeaderResType">
                                        <con2:path>$esbContext/esb:responseHeader/*[1]</con2:path>
                                    </con2:param>
                                    <con2:param name="rechargeServiceResponse">
                                        <con2:path>$rechargeServiceResponse</con2:path>
                                    </con2:param>
                                </con2:xqueryTransform>
                            </con1:expr>
                        </con1:replace>
                    </con:actions>
                </con:stage>
            </con:placeholder-override>
            <con:placeholder-override id="PlaceholderID_a00020f.5c9e8f14.0.150870ea46a.N7dd2">
                <con:actions/>
            </con:placeholder-override>
            <con:placeholder-override id="PlaceholderID_a00020f.5c9e8f14.0.150870ea46a.N7a26">
                <con:actions>
                    <con1:assign varName="serviceFault" xmlns:con1="http://www.bea.com/wli/sb/stages/transform/config">
                        <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-a0a7841.3eda9398.0.1534362093c.N7f4a</con2:id>
                        <con1:expr>
                            <con2:xqueryTransform xmlns:con2="http://www.bea.com/wli/sb/stages/config">
                                <con2:resource ref="BalanceManagement/XQueries/RechargeAgainstBillToFault"/>
                                <con2:param name="errorTrace">
                                    <con2:path>$errorTrace</con2:path>
                                </con2:param>
                            </con2:xqueryTransform>
                        </con1:expr>
                    </con1:assign>
                </con:actions>
            </con:placeholder-override>
            <con:action-override id="_ActionId-a00020f.Nc6ee96d.0.15095d4999c.N7e3c">
                <con1:route xmlns:con1="http://www.bea.com/wli/sb/stages/publish/config">
                    <con1:service ref="AmdocsCommon/BusinessServices/EsbTraceBS" xsi:type="ref:BusinessServiceRef" xmlns:ref="http://www.bea.com/wli/sb/reference" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/>
                </con1:route>
            </con:action-override>
            <con:placeholder-override id="PlaceholderID_a00020f.5c9e8f14.0.150870ea46a.N7b1e">
                <con:stage id="_StageId-a0a7841.N6aeb772f.3.152fa534e2a.N7fa5" name="Stage1">
                    <con:context/>
                    <con:actions>
                        <con1:reply isError="true" xmlns:con1="http://www.bea.com/wli/sb/stages/config">
                            <con1:id>_ActionId-a0a7841.N6aeb772f.3.152fa534e2a.N7f43</con1:id>
                        </con1:reply>
                    </con:actions>
                </con:stage>
            </con:placeholder-override>
        </con:template-overrides>
    </con:router>
    <con:template ref="AmdocsCommon/Pipelines/AmdocsInternalPipelineTemplate"/>
</con:pipelineEntry>